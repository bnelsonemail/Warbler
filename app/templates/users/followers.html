{% extends 'users/detail.html' %}

{% block user_details %}
<div class="container-fluid p-0">
  <!-- Header Image Section -->
  <div style="position: relative; background-color: #f8f9fa;">
    <img src="{{ user.header_image_url or url_for('static', filename='images/warbler-hero.jpg') }}" 
         alt="Header image for {{ user.username }}" 
         class="img-fluid w-100" 
         style="height: 400px; object-fit: cover;"
         onerror="this.src='/static/images/warbler-hero.jpg'; console.error('Header image failed to load, using fallback.');">

    <!-- User Image (Overlapping Header Image) -->
    <div style="position: absolute; bottom: -60px; left: 40px;">
      <img src="{{ user.image_url or url_for('static', filename='images/warbler-profile.jpg') }}" 
           alt="Profile image for {{ user.username }}" 
           class="rounded-circle border border-white shadow" 
           style="width: 140px; height: 140px; object-fit: cover;"
           onerror="this.src='/static/images/warbler-profile.jpg'; console.error('Profile image failed to load, using fallback.');">
      <h4 class="mt-3">@{{ user.username }}</h4>
    </div>
  </div>

  <!-- Add Margin to Push Content Down -->
  <div class="container" style="margin-top: 100px;">
    <!-- User Stats Section -->
    <div class="row justify-content-between align-items-center py-3 px-4" 
         style="background-color: #ffffff; border-radius: 10px;">
      <div class="col-md-auto text-center">
        <p class="mb-0"><strong>Messages</strong></p>
        <h5>
          <a href="/users/{{ user.id }}" class="text-decoration-none text-dark">
            {{ user.messages | length }}
          </a>
        </h5>
      </div>
      <div class="col-md-auto text-center">
        <p class="mb-0"><strong>Following</strong></p>
        <h5>
          <a href="/users/{{ user.id }}/following" class="text-decoration-none text-dark">
            {{ user.following | length }}
          </a>
        </h5>
      </div>
      <div class="col-md-auto text-center">
        <p class="mb-0"><strong>Followers</strong></p>
        <h5>
          <a href="/users/{{ user.id }}/followers" class="text-decoration-none text-dark">
            {{ user.followers | length }}
          </a>
        </h5>
      </div>
      <div class="col-md-auto text-center">
        <p class="mb-0"><strong>Likes</strong></p>
        <h5 class="text-dark">{{ likes | length }}</h5>
      </div>
    </div>
  </div>

  <!-- Location and Bio Section -->
  <div class="container py-4 mt-3" style="background-color: #f1f1f1; border-radius: 10px;">
    <div>
      <p><strong>Location:</strong> {{ user.location or 'N/A' }}</p>
      <p><strong>Bio:</strong> {{ user.bio or 'No bio available.' }}</p>
    </div>
  </div>

  <!-- Followers Section -->
  <div class="container py-4 mt-3">
    <div class="row">
      {% for follower in user.followers %}
        <div class="col-lg-4 col-md-6 col-12 mb-4">
          <div class="card user-card shadow-sm">
            <div class="card-inner">
              <div class="image-wrapper">
                <img src="{{ follower.header_image_url or url_for('static', filename='images/warbler-hero.jpg') }}" 
                     alt="" 
                     class="card-hero img-fluid"
                     onerror="this.src='/static/images/warbler-hero.jpg'; console.error('Follower header image fallback.');">
              </div>
              <div class="card-contents text-center p-3">
                <a href="/users/{{ follower.id }}" class="card-link text-decoration-none">
                  <img src="{{ follower.image_url or url_for('static', filename='images/warbler-profile.jpg') }}" 
                       alt="Image for {{ follower.username }}" 
                       class="card-image rounded-circle border border-white shadow"
                       style="width: 80px; height: 80px; object-fit: cover;"
                       onerror="this.src='/static/images/warbler-profile.jpg'; console.error('Follower profile image fallback.');">
                  <p class="mt-2">@{{ follower.username }}</p>
                </a>

                {% if g.user and g.user.is_following(follower) %}
                  <form method="POST" action="/users/stop-following/{{ follower.id }}">
                    <button class="btn btn-primary btn-sm">Unfollow</button>
                  </form>
                {% else %}
                  <form method="POST" action="/users/follow/{{ follower.id }}">
                    <button class="btn btn-outline-primary btn-sm">Follow</button>
                  </form>
                {% endif %}
              </div>
              <div class="p-3" style="background-color: #f9f9f9;">
                <p><strong>Location:</strong> {{ follower.location or 'N/A' }}</p>
                <p><strong>Bio:</strong> {{ follower.bio or 'No bio available.' }}</p>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}

